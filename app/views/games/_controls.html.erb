<div class="controls">
  <% owned_territories = @turn.game_state.owned_territories(@turn.player).map(&:name) %>

  <% if @turn.can_attack? %>
    <%= form_for [@game, Event.attack.new] do |f| %>
      <%= f.hidden_field :event_type %>
      Attack with <%= number_field_tag :units, "" %> units
      from <%= select_tag :from, options_for_select(owned_territories) %>
      to <%= select_tag :to, options_for_select(@game.territories.pluck(:name) - owned_territories) %>
      <%= button_tag type: "submit", class: "icon-button" do %>
        <span class="icon attack"></span> Attack
      <% end %>
    <% end %>
  <% end %>

  <% if @turn.can_fortify? %>
    <%= form_for [@game, Event.fortify.new] do |f| %>
      <%= f.hidden_field :event_type %>
      Move <%= number_field_tag :units, "" %> units
      from <%= select_tag :from, options_for_select(owned_territories) %>
      to <%= select_tag :to, options_for_select(owned_territories) %>
      <%= button_tag type: "submit", class: "icon-button" do %>
        <span class="icon fortify"></span> Fortify
      <% end %>
    <% end %>
  <% end %>

  <% if @turn.can_reinforce? %>
    <p><%= @turn.reinforcements.remaining_units %> reinforcements available.</p>

    <%= form_for [@game, Event.reinforce.new] do |f| %>
      <%= f.hidden_field :event_type %>
      Place <%= number_field_tag :units, "" %> units
      on <%= select_tag :to, options_for_select(owned_territories) %>
      <%= button_tag type: "submit", class: "icon-button" do %>
        <span class="icon reinforce"></span> Reinforce
      <% end %>
    <% end %>
  <% end %>

  <%= form_for [@game, Event.start_turn.new] do |f| %>
    <%= f.hidden_field :event_type %>
    <%= button_tag type: "submit", class: "icon-button" do %>
      <span class="icon end-turn"></span> End turn
    <% end %>
  <% end %>
</div>
